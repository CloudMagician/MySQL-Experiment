USE SCHOOL;

-- 1
SELECT STUDENT.SNAME, SC.GRADE
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
WHERE CNAME = 'Bibliometrics';

-- 2
SELECT COUNT(DISTINCT SNO)
FROM  SC
WHERE SC.GRADE < 60;

-- 3
SELECT SNAME, SSEX, SNO
FROM STUDENT
WHERE SNAME LIKE '%Z%';

-- 4
SELECT STUDENT.SNO, SC.GRADE
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
WHERE CNAME = 'Introduction to the Internet'
ORDER BY SC.GRADE DESC;

-- 5
SELECT SUM(COURSE.CTIME)
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
WHERE SNAME = 'Zuo li';

-- 6
SELECT AVG(SC.GRADE)
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
WHERE STUDENT.SAGE >= 20;

-- 7
SELECT COUNT(DISTINCT STUDENT.SNO)
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
WHERE STUDENT.SDEPT = 'computer science'
AND COURSE.CNAME = 'Database System';

-- 8
SELECT SNAME
FROM (
    SELECT STUDENT.SNAME, COURSE.CNAME
    FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
    JOIN COURSE ON SC.CNO = COURSE.CNO
    WHERE STUDENT.SNAME IN (
        SELECT STUDENT.SNAME
        FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
        JOIN COURSE ON SC.CNO = COURSE.CNO
        WHERE COURSE.CNAME = 'Database System'
    )
)
AS TEMP
WHERE CNAME = 'Introduction to the Internet';

-- 9
SELECT STUDENT.SNAME
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
WHERE COURSE.CNO IN (
    SELECT COURSE.CNO
    FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
    JOIN COURSE ON SC.CNO = COURSE.CNO
    WHERE STUDENT.SNAME = 'Wang gang'
);

-- 10
SELECT STUDENT.SNAME, STUDENT.SDEPT
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
WHERE COURSE.CNAME = 'Information Technology for Information Management'
AND SC.GRADE IS NULL;

-- 11
SELECT STUDENT.SNO, SUM(SC.GRADE)
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
WHERE STUDENT.SDEPT = 'computer science'
GROUP BY STUDENT.SNO;

-- 12
SELECT STUDENT.SNAME
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
GROUP BY STUDENT.SNO
HAVING AVG(SC.GRADE) > (
    SELECT AVG(SC.GRADE)
    FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
    JOIN COURSE ON SC.CNO = COURSE.CNO
);

-- 13
SELECT STUDENT.SNAME
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
WHERE STUDENT.SSEX = 'male'
GROUP BY STUDENT.SNO
HAVING AVG(SC.GRADE) > (
    SELECT AVG(SC.GRADE)
    FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
    JOIN COURSE ON SC.CNO = COURSE.CNO
    WHERE STUDENT.SSEX = 'female'
);

-- 14
SELECT STUDENT.SNAME
FROM STUDENT
WHERE SAGE > (
    SELECT MAX(SAGE)
    FROM STUDENT
    WHERE SDEPT = 'computer science'
);

-- 15
SELECT STUDENT.SNAME
FROM (STUDENT JOIN SC ON STUDENT.SNO = SC.SNO)
JOIN COURSE ON SC.CNO = COURSE.CNO
WHERE SC.GRADE < 60
GROUP BY STUDENT.SNO
HAVING COUNT(STUDENT.SNAME) = 1;