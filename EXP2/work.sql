USE BANK;

-- 1
-- 同实验一第12题

-- 2
-- 同实验一第13题

-- 3
-- 同实验一第14题

-- 4
-- 同实验一第15题

-- 5
-- 同实验一第16题

-- 6
SELECT CUSTOMER_NAME 
FROM (DEPOSITOR LEFT JOIN ACCOUNT ON DEPOSITOR.ACCOUNT_NUMBER = ACCOUNT.ACCOUNT_NUMBER)
LEFT JOIN BRANCH ON BRANCH.BRANCH_NAME = ACCOUNT.BRANCH_NAME
GROUP BY DEPOSITOR.CUSTOMER_NAME
HAVING COUNT(DISTINCT(ACCOUNT.BRANCH_NAME)) = (
    SELECT COUNT(BRANCH_NAME)
    FROM BRANCH 
    WHERE BRANCH_CITY = 'Brooklyn'
);

-- 7
-- CREATE VIEW BC_VIEW AS
-- (SELECT BRANCH.BRANCH_NAME, CUSTOMER_NAME
-- FROM (BRANCH JOIN ACCOUNT ON BRANCH.BRANCH_NAME = ACCOUNT.BRANCH_NAME)
-- JOIN DEPOSITOR ON ACCOUNT.ACCOUNT_NUMBER = DEPOSITOR.ACCOUNT_NUMBER
-- UNION
-- SELECT BRANCH.BRANCH_NAME, CUSTOMER_NAME
-- FROM (BRANCH JOIN LOAN ON BRANCH.BRANCH_NAME = LOAN.BRANCH_NAME)
-- JOIN BORROWER ON LOAN.LOAN_NUMBER = BORROWER.LOAN_NUMBER);
-- SELECT * FROM BC_VIEW;
-- DROP VIEW BC_VIEW;

-- 8
DELETE 
FROM ACCOUNT 
WHERE BRANCH_NAME = 'Perryridge';
SELECT * FROM ACCOUNT;
SELECT * FROM DEPOSITOR;

-- 9
DELETE ACCOUNT
FROM ACCOUNT JOIN BRANCH ON ACCOUNT.BRANCH_NAME = BRANCH.BRANCH_NAME
WHERE BRANCH_CITY = 'Needham';
SELECT * FROM ACCOUNT;
SELECT * FROM DEPOSITOR;

-- 10
SET @I = (SELECT AVG(BALANCE) FROM ACCOUNT);
DELETE 
FROM ACCOUNT
WHERE BALANCE < @I;
SELECT * FROM ACCOUNT;
SELECT * FROM DEPOSITOR;

-- 11
INSERT INTO ACCOUNT
VALUES ('A-9732', 'Perryridge', 1200);
SELECT * FROM ACCOUNT;

-- 12
INSERT INTO ACCOUNT
VALUES ('A-777', 'Perryridge', NULL);
SELECT * FROM ACCOUNT;

-- 13
INSERT INTO ACCOUNT 
SELECT LOAN.LOAN_NUMBER, 'Perryridge', 200
FROM LOAN
WHERE LOAN.BRANCH_NAME = 'Perryridge';
SELECT * FROM ACCOUNT;

-- 14
UPDATE ACCOUNT 
SET BALANCE = BALANCE *
CASE 
WHEN BALANCE > 10000 
THEN 1.06
ELSE 1.05
END;
SELECT * FROM ACCOUNT;

-- 15
SELECT CUSTOMER_NAME 
FROM CUSTOMER
WHERE CUSTOMER_STREET LIKE 'Main%';

-- 16
SELECT CUSTOMER_NAME 
FROM BORROWER JOIN LOAN ON BORROWER.LOAN_NUMBER = LOAN.LOAN_NUMBER
WHERE BRANCH_NAME = 'Perryridge'
ORDER BY CUSTOMER_NAME ASC;